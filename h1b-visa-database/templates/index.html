<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>U.S. Work Visa Database</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <header class="bg-primary text-white p-4">
        <div class="container">
            <h1>U.S. Work Visa Database</h1>
            <p class="lead">Search through Labor Condition Applications and visa disclosures (H-1B, H-2A, H-2B)</p>
        </div>
    </header>

    <main class="container mt-4">
        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Search Filters</h5>
                    </div>
                    <div class="card-body">
                        <form id="searchForm">
                            <!-- Visa Type Selection -->
                            <div class="mb-3">
                                <label for="visa_type" class="form-label">Visa Type</label>
                                <select class="form-select" id="visa_type" name="visa_type">
                                    {% for visa_type, data in available_data.items() %}
                                        <option value="{{ visa_type }}"{% if visa_type == 'LCA' %} selected{% endif %}>{{ data.label }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <!-- Year Selection -->
                            <div class="mb-3">
                                <label for="year" class="form-label">Fiscal Year</label>
                                <select class="form-select" id="year" name="year">
                                    <option value="">All Years</option>
                                    <!-- Years will be populated via JS based on visa type -->
                                </select>
                            </div>
                            
                            <!-- Quarter Selection -->
                            <div class="mb-3">
                                <label for="quarter" class="form-label">Quarter</label>
                                <select class="form-select" id="quarter" name="quarter">
                                    <option value="">All Quarters</option>
                                    <option value="1">Q1</option>
                                    <option value="2">Q2</option>
                                    <option value="3">Q3</option>
                                    <option value="4">Q4</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="column" class="form-label">Search Field</label>
                                <select class="form-select" id="column" name="column">
                                    <option value="">All Fields</option>
                                    <!-- Columns will be populated via JS based on visa type -->
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="query" class="form-label">Search Query</label>
                                <input type="text" class="form-control" id="query" name="query" placeholder="Enter keywords...">
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100">Search</button>
                        </form>
                    </div>
                </div>
                
                <!-- Stats Card -->
                <div class="card mt-4">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">Dataset Statistics</h5>
                    </div>
                    <div class="card-body" id="statsContainer">
                        <div class="text-center">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Available Files Card -->
                <div class="card mt-4">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0">Available Data</h5>
                    </div>
                    <div class="card-body">
                        <div class="accordion" id="dataAccordion">
                            {% for visa_type, data in available_data.items() %}
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ visa_type }}" aria-expanded="false" aria-controls="collapse{{ visa_type }}">
                                            {{ data.label }}
                                        </button>
                                    </h2>
                                    <div id="collapse{{ visa_type }}" class="accordion-collapse collapse" data-bs-parent="#dataAccordion">
                                        <div class="accordion-body">
                                            <ul class="list-group">
                                                {% for year in data.years|sort(reverse=true) %}
                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                        FY{{ year }}
                                                        <span class="badge bg-primary rounded-pill visa-year-selector" 
                                                              data-visa-type="{{ visa_type }}" 
                                                              data-year="{{ year }}">
                                                            Select
                                                        </span>
                                                    </li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Search Results</h5>
                        <span class="badge bg-light text-dark" id="resultCount">0 results</span>
                    </div>
                    <div class="card-body">
                        <div id="loadingResults" class="text-center">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                        <div id="resultsContainer" class="table-responsive" style="display: none;">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr id="resultsHeader"></tr>
                                </thead>
                                <tbody id="resultsBody"></tbody>
                            </table>
                        </div>
                        <div id="noResults" class="text-center" style="display: none;">
                            <p class="text-muted">No results found. Try modifying your search.</p>
                        </div>
                        
                        <!-- Pagination -->
                        <nav aria-label="Search results pages" id="pagination" style="display: none;">
                            <ul class="pagination justify-content-center"></ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <footer class="bg-dark text-white text-center p-3 mt-5">
        <div class="container">
            <p class="mb-0">U.S. Work Visa Database &copy; 2025 | Data from U.S. Department of Labor</p>
        </div>
    </footer>
    
    <!-- Data for JavaScript -->
    <script>
        // Pass data from Flask to JavaScript
        const availableData = JSON.parse('{{ available_data|tojson|safe }}');
        const visaTypes = JSON.parse('{{ visa_types|tojson|safe }}');
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
